repositories:
  - name: longhorn
    url: https://charts.longhorn.io

releases:
###  CORE CONFIGURATION ###
  - name: traefik-config
    chart: ./core/traefik-config
    historyMax: 5
    namespace: kube-system
  - name: namespaces
    chart: ./core/namespaces
    historyMax: 5
    namespace: kube-system
  - name: rbac-policies
    chart: ./core/rbac-policies
    historyMax: 5
    namespace: kube-system
    needs: [namespaces]

###  STORAGE CONFIGURATION ###
  - name: longhorn
    chart: ./storage/longhorn
    historyMax: 5
    namespace: longhorn-system
    createNamespace: true

hooks:
  - events: ["prepare"]
    showlogs: true
    command: "kubectl"
    args: ["label", "node", "server-node-0", "svccontroller.k3s.cattle.io/enablelb=true", "--overwrite"]
  - events: ["prepare"]
    showlogs: true
    command: "kubectl"
    args: ["label", "node", "agent-node-0", "node-role.kubernetes.io/worker=true", "--overwrite"]